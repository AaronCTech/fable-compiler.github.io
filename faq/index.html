<html><head><title>Fable FAQ</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700|Roboto+Mono"/><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" type="text/css" href="/css/styles.css"/><link rel="stylesheet" type="text/css" href="/css/highlight.css"/><link rel="shortcut icon" href="/img/fable.ico"/></head><body><nav class="navbar"><div class="navbar-brand"><div class="navbar-item title is-4">Fable</div><div class="navbar-burger" data-target="navMenu"><span></span><span></span><span></span></div></div><div id="navMenu" class=" navbar-menu"><div class="navbar-start"><a class=" navbar-item" href="/">Home</a><a class=" navbar-item" href="/repl">REPL</a><a class=" navbar-item" href="/blog">Blog</a><a class=" navbar-item" href="/docs">Docs</a><a class=" navbar-item is-active" href="/faq">FAQ</a><a class=" navbar-item" href="/fableconf">FableConf</a></div><div class="navbar-end"><div class="navbar-item"><div class="field is-grouped"><div class="control"><a class="button twitter" href="https://twitter.com/FableCompiler"><span class="icon"><i class="fa fa-twitter"></i></span><span>Share the love!</span></a></div><div class="control"><a class="button github" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class="fa fa-comments"></i></span><span>Chat</span></a></div><div class="control"><a class="button github" href="https://github.com/fable-compiler/Fable"><span class="icon"><i class="fa fa-github"></i></span><span>Contribute</span></a></div></div></div></div></div></nav><div class="markdown faq" style="overflow:hidden"><section class="hero fable-header"><div class="hero-body"><div class="container"><div class="columns is-vcentered"><div class="column"><img class="fable-logo" src="/img/fable_logo.png"/></div><div class="column    has-text-right        "><h1 class="title is-1">FAQ</h1><h1 class="subtitle is-4">The place to find a quick answer to your questions</h1></div></div></div></div></section><div style="margin-top:1.6rem"><div class="columns"><div class="column"></div><div class="column is-two-thirds"><div class="content" style="margin:5px"><h1><a name="faq" class="anchor" href="#faq">FAQ</a></h1><p>This is the section for quick questions or to miss the holes in the documentation. Check the first question below to learn how you can help make the FAQ a great resource for Fable users.</p>
<h2><a name="general" class="anchor" href="#general">General</a></h2><h4><a name="how-can-i-add-a-new-question-" class="anchor" href="#how-can-i-add-a-new-question-">How can I add a new question?</a></h4><p>Make sure the question is not answered already either here or in the documentation. Then just <a href="https://github.com/fable-compiler/Fable/blob/master/docs/FAQ.md">click here to edit this page in Github</a>, add your question to the bottom and create a PR. Maintainers will write an answer and ask you if that solves the issue. If it does, the PR will be merged and the question will be added to the page so it can be referenced by other users.</p>
<h2><a name="compiler" class="anchor" href="#compiler">Compiler</a></h2><h4><a name="how-does-fable-work-" class="anchor" href="#how-does-fable-work-">How does Fable work?</a></h4><p>Fable has two &quot;hearts&quot; or sides: the .NET side is a daemon (a lightweight TCP server listening by default on port 61225) that waits for messages containing the F# source (.fs) or project (.fsproj) file to parse together with other options, and returns its contents in the form of a <a href="https://github.com/babel/babel/blob/master/packages/babel-parser/ast/spec.md">Babel compliant AST</a>.</p>
<p>On the other side, there is a JS client that takes care of watching the files, communicating with the Fable daemon, resolving npm dependencies and outputting the actual JS code. At the time of writing there are three JS clients for Fable available:</p>
<ul>
<li><a href="https://www.npmjs.com/package/fable-loader">fable-loader</a> is a plugin for <a href="https://webpack.js.org/">Webpack</a>, a powerful JS bundler with many handy features for development, like live reloading.</li>
<li><a href="https://www.npmjs.com/package/rollup-plugin-fable">rollup-plugin-fable</a> for <a href="https://rollupjs.org/">Rollup</a>, another bundler focused on tree shaking.</li>
<li><a href="https://www.npmjs.com/package/fable-splitter">fable-splitter</a> is a standalone tool which, unlike the previous ones, outputs separated files instead of a single bundle.</li>
</ul>
<blockquote>
<p>All the clients need a configuration file, click the links above for more details.</p>
</blockquote>
<p>The usual way to run a JS tool is a <a href="https://docs.npmjs.com/misc/scripts">package.json script</a>, so when you type <code>npm run build</code> this will invoke a command named &quot;build&quot; within the &quot;scripts&quot; property of the package.json file. For convenience, you can tell Fable to automatically start the package.json script and stop whenever it finishes:</p>
<pre><code class="language-shell">dotnet fable npm-run build</code></pre>
<p>The Fable daemon must be invoked in a directory with an .fsproj including a <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/extensibility#per-project-based-extensibility">dotnet CLI tool reference</a> to the <code>dotnet-fable</code> Nuget package (<a href="https://fsprojects.github.io/Paket/nuget-dependencies.html#Special-case-CLI-tools">how to manage CLI tools with Paket</a>). Run <code>dotnet fable --help</code> to know more about the Fable daemon specific options.</p>
<p>It is also possible to run the Fable daemon and the JS clients separately if necessary:</p>
<pre><code class="language-shell">dotnet fable start
<span class="hljs-meta">
#</span><span class="bash"> In a different shell</span>
npm run build</code></pre>
<h4><a name="can-i-use-type-providers-with-fable-" class="anchor" href="#can-i-use-type-providers-with-fable-">Can I use Type Providers with Fable?</a></h4><p>Erasure Type Providers compatible with netstandard should be compatible with Fable, however they must generate code that doesn&#39;t call .NET APIs unsupported by Fable. At the time of writing there are no Type Providers designed for Fable available.</p>
<h4><a name="how-can-i-run-a-certain-piece-of-code-only-in-my-production-build-" class="anchor" href="#how-can-i-run-a-certain-piece-of-code-only-in-my-production-build-">How can I run a certain piece of code only in my production build?</a></h4><p>Using a <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/compiler-directives">Compiler Directive</a>.</p>
<pre><code class="language-fsharp">#<span class="hljs-keyword">if</span> !DEBUG
printfn <span class="hljs-string">"only printing in production bundle"</span>
#endif</code></pre>
<p>You can define compilation directives using the <code>define</code> option in your Fable client. Latest <a href="https://www.npmjs.com/package/fable-loader">fable-loader</a> will automatically define <code>DEBUG</code> when running Webpack in development mode.</p>
<h4><a name="how-can-i-make-the-compilation-fail-on-incomplete-pattern-matches-" class="anchor" href="#how-can-i-make-the-compilation-fail-on-incomplete-pattern-matches-">How can I make the compilation fail on incomplete pattern matches?</a></h4><p>Fable emits a warning on incomplete pattern matching expressions by default. To turn this particular warning into an error, add the following block to your project file:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span> <span class="hljs-attr">Sdk</span>=<span class="hljs-string">"Microsoft.NET.Sdk"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... --&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- FS0025: Incomplete pattern matches on this expression. --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">WarningsAsErrors</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">WarningsAsErrors</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span></code></pre>
<p>This setting will not only make your compilation process fail on the command line, but will also make your IDE show an error at the location in the source code.</p>
<p>To turn more warnings into errors, separate them with commas or semicolons.</p>
<h4><a name="how-are-numbers-compiled-to-js-" class="anchor" href="#how-are-numbers-compiled-to-js-">How are numbers compiled to JS?</a></h4><p>All numeric types including decimal become <code>JS number</code> (64-bit floating type), except for longs and big integers. Tom Clarke has documented in much more detail the differences in numeric types between .NET and JS, <a href="../docs/numbers.html">check it out</a>.</p>
<h2><a name="fable-core" class="anchor" href="#fable-core">Fable.Core</a></h2><h4><a name="which-operators-are-used-in-fable-core-" class="anchor" href="#which-operators-are-used-in-fable-core-">Which operators are used in Fable.Core?</a></h4><p>The <code>Fable.Core.JsInterop</code> module provides three main operators to interact with JS (all of them erased in generated JS code): <code>?</code> to dynamically access a property of an object, <code>!!</code> for unsafe casting (equivalent to <code>unbox</code>) and <code>!^</code> to pass arguments to a method accepting <a href="../docs/interacting.md#erase-attribute">Erased Unions</a>.</p>
<pre><code class="language-fsharp"><span class="hljs-keyword">open</span> Fable.Core.JsInterop

<span class="hljs-keyword">let</span> jqElement = Browser.window?jQuery
<span class="hljs-keyword">let</span> result: float = !!myObj?bar(<span class="hljs-number">5</span>)
myObject?aProperty &lt;- <span class="hljs-number">30</span>

<span class="hljs-keyword">let</span> myMethod (arg: U3&lt;string, int, Test&gt;) = ...
myMethod !^<span class="hljs-number">5</span> <span class="hljs-comment">// Same as: myMethod (U3.Case2 5)</span></code></pre>
<h4><a name="how-can-i-create-a-js-object-" class="anchor" href="#how-can-i-create-a-js-object-">How can I create a JS object?</a></h4><p>The <code>Fable.Core.JsInterop</code> module provides three helpers to create JS object. The first one, <code>createObj</code>, is used to dynamically create a JS object with string keys:</p>
<pre><code class="language-fsharp"><span class="hljs-keyword">open</span> Fable.Core.JsInterop

<span class="hljs-comment">// { a: 5, b: aValue }</span>
createObj [
    <span class="hljs-string">"a"</span> ==&gt; <span class="hljs-number">5</span>
    <span class="hljs-string">"b"</span> ==&gt; aValue
]</code></pre>
<p>If you have an interface definition for the JS object you can just use an <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/object-expressions">F# Object Expression</a>. However, in many cases you only want to set a few fields, as when you pass options to a JS library, in those cases you can use <code>jsOptions</code> and a lambda to declare your object and have the compiler type-check the fields:</p>
<pre><code class="language-fsharp"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">IFoo</span> </span>=
    <span class="hljs-keyword">abstract</span> foo: string <span class="hljs-keyword">with</span> get, set
    <span class="hljs-keyword">abstract</span> bar: int <span class="hljs-keyword">with</span> get, set
    <span class="hljs-keyword">abstract</span> optionalField: obj <span class="hljs-keyword">with</span> get, set

<span class="hljs-keyword">let</span> myJsApi (options: IFoo) = importMember <span class="hljs-string">"foo-module"</span>

<span class="hljs-comment">// JS: { foo: "foo", bar: 5 }</span>
myJsApi (jsOptions(<span class="hljs-keyword">fun</span> (o: IFoo) -&gt;
    o.foo &lt;- <span class="hljs-string">"foo"</span>
    o.bar &lt;- <span class="hljs-number">5</span>
))</code></pre>
<p>If you use these helpers multiple times, you may want to define custom prefix operators for a terser syntax. For example:</p>
<pre><code class="language-fsharp"><span class="hljs-keyword">let</span> <span class="hljs-keyword">inline</span> (~%) x = createObj x
<span class="hljs-keyword">let</span> <span class="hljs-keyword">inline</span> (~%%) x = jsOptions x

anotherJsApi %[<span class="hljs-string">"bar"</span> ==&gt; <span class="hljs-number">10</span>]
myJsApi %%(<span class="hljs-keyword">fun</span> o -&gt; o.foo &lt;- <span class="hljs-string">"foo"</span>)</code></pre>
<p>Finally, some libraries (like React bindings) use F# unions to represent fields of JS objects. In those cases you can use <code>keyValueList</code> to transform a list of union cases to a JS object.</p>
<pre><code class="language-fsharp"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">MyOptions</span> </span>=
    | Foo <span class="hljs-keyword">of</span> string
    | Bar <span class="hljs-keyword">of</span> int

<span class="hljs-comment">// JS: { foo: "foo", bar: 5 }</span>
<span class="hljs-comment">// Note we use the caseRules argument to change the first letter</span>
keyValueList CaseRules.LowerFirst [
    Foo <span class="hljs-string">"foo"</span>
    Bar <span class="hljs-number">5</span>
]</code></pre>
<h2><a name="library-authors" class="anchor" href="#library-authors">Library authors</a></h2><h4><a name="which-files-need-to-be-included-in-the-nuget-package-" class="anchor" href="#which-files-need-to-be-included-in-the-nuget-package-">Which files need to be included in the nuget package?</a></h4><p>The F# source code and the F# project file have to be included in the Nuget Package in a folder named <code>fable</code> within the package. This may sound complicated but it&#39;s only a matter of adding a couple of lines to your project file and let the <code>dotnet pack</code> command do all the rest.</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- Add source files to "fable" folder in Nuget package --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"*.fsproj; **\*.fs"</span> <span class="hljs-attr">PackagePath</span>=<span class="hljs-string">"fable\"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span></code></pre>
<p>Possible cryptic error message when you don&#39;t include the project file and/or source files is <code>Cannot find root module</code>.</p>
<h2><a name="unit-tests" class="anchor" href="#unit-tests">Unit tests</a></h2><h4><a name="how-do-i-add-unit-tests-to-an-existing-project-" class="anchor" href="#how-do-i-add-unit-tests-to-an-existing-project-">How do I add unit tests to an existing project?</a></h4><p>Writing unit tests in Fable requires that the F# files are compiled to a format that can be processed by a nodejs test runner (f.ex Jest or Mocha).
In general you don&#39;t really need one bundle with all your test files, so the easiest way is to have every test file compiled as individual file.</p>
<p><a href="https://github.com/fable-compiler/Fable/tree/master/src/js/fable-splitter">fable-splitter</a> can be used to achieve this. To run tests in nodejs you typically don&#39;t need ES5 code, the only real requirement is that ES6 modules are transpiled to commonjs (as this is the format nodejs uses). This can be achieve with the <a href="https://babeljs.io/docs/en/next/babel-plugin-transform-modules-commonjs.html">@babel/plugin-transform-modules-commonjs</a> babel plugin. </p>
<p>Example configuration for the fable splitter:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolve</span>(<span class="hljs-params">relativePath</span>) </span>{
    <span class="hljs-keyword">return</span> path.join(__dirname, relativePath);
}

<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">entry</span>: resolve(<span class="hljs-string">"test/test.fsproj"</span>),
    <span class="hljs-attr">outDir</span>: resolve(<span class="hljs-string">"test/output"</span>),
    <span class="hljs-attr">babel</span>: {
        <span class="hljs-string">"plugins"</span>: [<span class="hljs-string">"@babel/plugin-transform-modules-commonjs"</span>]
    },
    <span class="hljs-attr">allFiles</span>: <span class="hljs-literal">true</span>
}</code></pre>
<p>Following F# test file <code>App.test.fs</code></p>
<pre><code class="language-fsharp"><span class="hljs-keyword">module</span> MyApp.Test
<span class="hljs-keyword">open</span> Fable.Import.Jest <span class="hljs-comment">// See https://github.com/jgrund/fable-jest</span>

test <span class="hljs-string">"Demo test"</span> &lt;| <span class="hljs-keyword">fun</span> () -&gt;
    expect.Invoke(sprintf <span class="hljs-string">"%d"</span> <span class="hljs-number">42</span>).toEqual(<span class="hljs-string">"42"</span>)</code></pre>
<p>gets compiled to <code>test/output/App.test.js</code></p>
<pre><code class="language-js"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> _String = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./fable-core.2.0.10/String"</span>);

test(<span class="hljs-string">"Demo test"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  expect((<span class="hljs-number">0</span>, _String.toText)((<span class="hljs-number">0</span>, _String.printf)(<span class="hljs-string">"%d"</span>))(<span class="hljs-number">42</span>)).toEqual(<span class="hljs-string">"42"</span>);
});</code></pre>
<p>which can be ran as normal JavaScript would run with our test runner (Jest in this example).</p>
<p>Compile the test with an npm script to trigger the splitter when the Fable daemon runs:</p>
<pre><code class="language-json">{
  <span class="hljs-attr">"scripts"</span> : {
     <span class="hljs-attr">"test"</span> : <span class="hljs-string">"jest"</span>,
     <span class="hljs-attr">"compile"</span> : <span class="hljs-string">"fable-splitter --config splitter.config.js"</span>
  }
}</code></pre>
<blockquote>
<p>npm run compile</p>
</blockquote>
<p>Once the compilation is complete: <code>npm test</code>.</p>
</div></div><div class="column"></div></div></div></div><footer><p>Fable <a href="https://github.com/fable-compiler/Fable">source code</a> is licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.</p></footer><script>
document.addEventListener('DOMContentLoaded', function () {
  var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
  if ($navbarBurgers.length > 0) {
    $navbarBurgers.forEach(function ($el) {
      $el.addEventListener('click', function () {
        var target = $el.dataset.target;
        var $target = document.getElementById(target);
        $el.classList.toggle('is-active');
        $target.classList.toggle('is-active');
      });
    });
  }
});</script></body></html>