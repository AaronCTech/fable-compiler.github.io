<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Alfonso Garcia-Caro">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700|Roboto+Mono' rel='stylesheet' type='text/css'>
    <link href="//fable.io/content/custom.css" rel='stylesheet' type='text/css'>
    <script src="//fable.io/content/tips.js"></script>
    <link rel="stylesheet" type="text/css" href="//fable.io/content/snippets.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <!--<script language="javascript" type="text/javascript">
      function init() {
          try {
            websocket = new WebSocket("ws://"+window.location.host+"/websocket");
            websocket.onmessage = function(evt) { location.reload(); };
          } catch(e) { /* For local development only */ }
      }
      window.addEventListener("load", init, false);
    </script>-->
    
  <title>Interacting with JavaScript - F# |> BABEL</title>
  <meta name="description" content="Fable features for easy interoperability">

</head>
<body>

  <div class="fable-navbar">
  <div class="container">
  <nav class="navbar navbar-default">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="//fable.io">Fable</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class=""><a href="//fable.io">home</a></li>
          <li class=""><a href="//fable.io/samples.html">samples</a></li>
          <li class=""><a href="//fable.io/docs.html">docs</a></li>
          <li class=""><a href="//fable.io/blog.html">blog</a></li>
        </ul>
      </div>
    </div>
  </nav>
  </div>
  </div>

  <div class="fable-content-wrapper">
  
<div class="fable-heading">
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h1>Interacting with JavaScript</h1>
      <p>Fable features for easy interoperability</p>
      <p class="links">
        <a href="https://twitter.com/FableCompiler"><i class="fa fa-twitter"></i> follow</a>
        <a href="https://github.com/fable-compiler/Fable"><i class="fa fa-github"></i> contribute</a>
        <a href="https://gitter.im/fable-compiler/Fable"><i class="fa fa-comments"></i> chat</a>
      </p>
    </div>
  </div>
</div>
</div>

<div class="container fable-content">
  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p><strong>Attention</strong>: This document corresponds to Fable 0.6.x and needs to be updated to the latest version. Please check the <a href="../blog/Introducing-0-7.html">migration guide</a>.</p>
<p>There are several ways to interact with the JavaScript world:</p>
<ul>
<li><a href="#Dynamic-programming">Dynamic programming</a></li>
<li><a href="#Foreign-interfaces">Foreign interfaces</a></li>
<li><a href="#Special-attributes">Special attributes</a></li>
<li><a href="#Calling-F-code-from-JavaScript">Calling F# code from JavaScript</a></li>
<li><a href="#JSON-serialization">JSON serialization</a></li>
<li><a href="#Publishing-a-Fable-package">Publishing a Fable package</a></li>
</ul>
<h2><a name="Dynamic-programming" class="anchor" href="#Dynamic-programming">Dynamic programming</a></h2>
<p><a href="https://github.com/fable-compiler/Fable/blob/master/src/fable/Fable.Core/Fable.Core.fs">Fable.Core.JsInterop</a>
implements the F# dynamic operators so you can easily access an object property by name (without static check)
as follows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="i">printfn</span> <span class="s">&quot;Value: %O&quot;</span> <span class="i">jsObject</span><span class="o">?</span><span class="i">myProperty</span>

<span class="k">let</span> <span class="i">pname</span> <span class="o">=</span> <span class="s">&quot;myProperty&quot;</span>

<span class="i">printfn</span> <span class="s">&quot;Value: %O&quot;</span> <span class="i">jsObject</span><span class="o">?</span>(<span class="i">pname</span>) <span class="c">// Access with a string reference</span>

<span class="i">jsObject</span><span class="o">?</span><span class="i">myProperty</span> <span class="o">&lt;-</span> <span class="n">5</span> <span class="c">// Assignment is also possible</span>
</code></pre></td>
</tr>
</table>
<p>When you combine the dynamic operator with application, Fable will destructure
tuple arguments as with normal method calls. These operations can also be chained
to replicate JS fluent APIs.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">jsObject</span><span class="o">?</span><span class="i">myMethod</span>(<span class="n">1</span>, <span class="n">2</span>)
<span class="c">// var result = jsObject.myMethod(1, 2)</span>

<span class="i">chart</span>
    <span class="o">?</span><span class="i">width</span>(<span class="n">768.</span>)
    <span class="o">?</span><span class="i">height</span>(<span class="n">480.</span>)
    <span class="o">?</span><span class="i">group</span>(<span class="i">speedSumGroup</span>)
    <span class="o">?</span><span class="i">on</span>(<span class="s">&quot;renderlet&quot;</span>, <span class="k">fun</span> <span class="i">chart</span> <span class="k">-&gt;</span>
        <span class="i">chart</span><span class="o">?</span><span class="i">selectAll</span>(<span class="s">&quot;rect&quot;</span>)<span class="o">?</span><span class="i">on</span>(<span class="s">&quot;click&quot;</span>, <span class="k">fun</span> <span class="i">d</span> <span class="k">-&gt;</span>
            <span class="i">Browser</span><span class="o">.</span><span class="i">console</span><span class="o">.</span><span class="i">log</span>(<span class="s">&quot;click!&quot;</span>, <span class="i">d</span>))
<span class="c">// chart</span>
<span class="c">//     .width(768)</span>
<span class="c">//     .height(480)</span>
<span class="c">//     .group(speedSumGroup)</span>
<span class="c">//     .on(&quot;renderlet&quot;, function (chart) {</span>
<span class="c">//         return chart.selectAll(&quot;rect&quot;).on(&quot;click&quot;, function (d) {</span>
<span class="c">//             return console.log(&quot;click!&quot;, d);</span>
<span class="c">//         });</span>
<span class="c">//      });</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>CAUTION: When you don't use the dynamic operator and apply a tuple
to a function value, it won't be destructured (tuples are translated
to JS arrays). See <em>Calling F# code from JavaScript</em> below for more info.
However, you can still use the <code>$</code> operator to destructure and apply a
tuple to an arbitrary value.</p>
</blockquote>
<p>If you want to call the function with the <code>new</code> keyword, use <code>Fable.Core.createNew</code> instead.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="k">let</span> <span class="i">instance</span> <span class="o">=</span> <span class="i">createNew</span> <span class="i">jsObject</span><span class="o">?</span><span class="i">method</span> (<span class="n">1</span>, <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
<p>And when you need to create JS object literals, use <code>createObj</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="k">let</span> <span class="i">data</span> <span class="o">=</span>
    <span class="i">createObj</span> [
        <span class="s">&quot;todos&quot;</span> <span class="o">==&gt;</span> <span class="i">Storage</span><span class="o">.</span><span class="i">fetch</span>()
        <span class="s">&quot;newTodo&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;&quot;</span>
        <span class="s">&quot;editedTodo&quot;</span> <span class="o">==&gt;</span> <span class="i">None</span>
        <span class="s">&quot;visibility&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;all&quot;</span>
    ]
</code></pre></td>
</tr>
</table>
<h2><a name="Foreign-interfaces" class="anchor" href="#Foreign-interfaces">Foreign interfaces</a></h2>
<p>Defining a foreign interface is trivial: just create a F# interface and the
compiler will call its properties or methods by name. The tricky part is to
tell the compiler where the objects should be retrieved from. Normally, they
will be exposed as values of an imported module, so you just need to indicate
the compiler where this module is coming from using the <code>Import</code> attribute (see below).
For example, if you want to use <code>string_decoder</code> from node, just write:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

[&lt;<span class="i">Import</span>(<span class="s">&quot;*&quot;</span>,<span class="s">&quot;string_decoder&quot;</span>)&gt;]
<span class="k">module</span> <span class="i">string_decoder</span> <span class="o">=</span>
    <span class="k">type</span> <span class="i">NodeStringDecoder</span> <span class="o">=</span>
        <span class="k">abstract</span> <span class="i">write</span><span class="o">:</span> <span class="i">buffer</span><span class="o">:</span> <span class="i">Buffer</span> <span class="k">-&gt;</span> <span class="i">strings</span>
        <span class="k">abstract</span> <span class="i">detectIncompleteChar</span><span class="o">:</span> <span class="i">buffer</span><span class="o">:</span> <span class="i">Buffer</span> <span class="k">-&gt;</span> <span class="i">float</span>

    <span class="k">let</span> <span class="i">StringDecoder</span><span class="o">:</span> <span class="i">NodeStringDecoder</span> <span class="o">=</span> <span class="i">jsNative</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>If a method accepts a lambda make sure to use <code>System.Func</code> in the signature to force
the compiler <em>uncurry</em> any lambda passed as parameter (see below).</p>
</blockquote>
<p>A good starting point for foreign interfaces are <a href="http://definitelytyped.org">Typescript definition files</a>
and there's a script to make the bulk work of translating the file into F#. You can install it from npm.
See the <a href="https://www.npmjs.com/package/ts2fable">README</a> for more information.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="shell">npm install -g ts2fable
</code></pre></td></tr></table>
<p>You can find common definitions already parsed <a href="https://github.com/fable-compiler/Fable/blob/master/import">here</a>.
Some of them are available in npm, just search for <code>fable-import</code> packages.</p>
<h2><a name="Special-attributes" class="anchor" href="#Special-attributes">Special attributes</a></h2>
<p>There are some attributes available in the <code>Fable.Core</code> namespace to ease the interaction with JS.</p>
<h3><a name="Emit-attribute" class="anchor" href="#Emit-attribute">Emit attribute</a></h3>
<p>You can use the <code>Emit</code> attribute to decorate a function. Every call to the
function will then be replaced <strong>inline</strong> by the content of the attribute
with the placeholders <code>$0</code>, <code>$1</code>, <code>$2</code>... replaced by the arguments. For example,
the following code will generate JavaScript as seen below.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

[&lt;<span class="i">Emit</span>(<span class="s">&quot;$0 + $1&quot;</span>)&gt;]
<span class="k">let</span> <span class="i">add</span> (<span class="i">x</span><span class="o">:</span> <span class="i">int</span>) (<span class="i">y</span><span class="o">:</span> <span class="i">string</span>)<span class="o">:</span> <span class="i">float</span> <span class="o">=</span> <span class="i">jsNative</span>

<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">add</span> <span class="n">1</span> <span class="s">&quot;2&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js"><span class="k">var</span> result <span class="o">=</span> <span class="n">1</span> <span class="o">+</span> <span class="s">"2"</span>
</code></pre></td></tr></table>
<p>When you don't know the exact number of arguments you can use the following syntax:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Test</span>() <span class="o">=</span>
    [&lt;<span class="i">Emit</span>(<span class="s">&quot;$0($1...)&quot;</span>)&gt;]
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span class="i">Invoke</span>([&lt;<span class="i">ParamArray</span>&gt;] <span class="i">args</span><span class="o">:</span> <span class="i">int</span>[])<span class="o">:</span> <span class="i">obj</span> <span class="o">=</span> <span class="i">jsNative</span>
</code></pre></td>
</tr>
</table>
<p>It's also possible to pass syntax conditioned to optional parameters.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Test</span>() <span class="o">=</span>
    [&lt;<span class="i">Emit</span>(<span class="s">&quot;$0[$1]{{=$2}}&quot;</span>)&gt;]
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span class="i">Item</span> <span class="k">with</span> <span class="i">get</span>()<span class="o">:</span> <span class="i">float</span> <span class="o">=</span> <span class="i">jsNative</span> <span class="k">and</span> <span class="i">set</span>(<span class="i">v</span><span class="o">:</span> <span class="i">float</span>)<span class="o">:</span> <span class="i">unit</span> <span class="o">=</span> <span class="i">jsNative</span>

    <span class="c">// This syntax means: if second arg evals to true in JS print &#39;i&#39; and nothing otherwise</span>
    [&lt;<span class="i">Emit</span>(<span class="s">&quot;new RegExp($0,&#39;g{{$1?i:}}&#39;)&quot;</span>)&gt;]
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span class="i">ParseRegex</span>(<span class="i">pattern</span><span class="o">:</span> <span class="i">string</span>, <span class="o">?</span><span class="i">ignoreCase</span><span class="o">:</span> <span class="i">bool</span>)<span class="o">:</span> <span class="i">Regex</span> <span class="o">=</span> <span class="i">jsNative</span>
</code></pre></td>
</tr>
</table>
<p>The content of <code>Emit</code> will actually be parsed by Babel so it will still be
validated somehow. However, it's not advised to abuse this method, as the
code in the template will remain obscure to Fable and may prevent some
optimizations.</p>
<h3><a name="Import-attribute" class="anchor" href="#Import-attribute">Import attribute</a></h3>
<p>The <code>Import</code> attribute can be applied to modules, types and even functions.
It will translate to <a href="https://developer.mozilla.org/en/docs/web/javascript/reference/statements/import">ES2015 import statements</a>,
which can be later transformed to <code>commonjs</code>, <code>amd</code> or <code>umd</code> imports by Babel.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Namespace imports</span>
[&lt;<span class="i">Import</span>(<span class="s">&quot;*&quot;</span>, <span class="i">from</span><span class="o">=</span><span class="s">&quot;my-module&quot;</span>)&gt;]
<span class="c">// import * from &quot;my-module&quot;</span>

<span class="c">// Member imports</span>
[&lt;<span class="i">Import</span>(<span class="s">&quot;myFunction&quot;</span>, <span class="i">from</span><span class="o">=</span><span class="s">&quot;my-module&quot;</span>)&gt;]
<span class="c">// import { myFunction } from &quot;my-module&quot;</span>

<span class="c">// Default imports</span>
[&lt;<span class="i">Import</span>(<span class="s">&quot;default&quot;</span>, <span class="i">from</span><span class="o">=</span><span class="s">&quot;express&quot;</span>)&gt;]
<span class="c">// import express from &quot;express&quot;</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>If the module or value is globally accessible in JavaScript,
you can use the <code>Global</code> attribute without parameters instead.
When importing a relative path (starting with <code>.</code> as in <code>./js/myLib.js</code>),
the path will be resolved so it can be reached from <code>outDir</code> in the compiled JS code.</p>
</blockquote>
<p><code>Fable.Core.JsInterop</code> also contains import expressions. These are mostly
useful when you need to import JS libraries without a foreign interface.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="k">let</span> <span class="i">buttons</span> <span class="o">=</span> <span class="i">importAll</span><span class="o">&lt;</span><span class="i">obj</span><span class="o">&gt;</span> <span class="s">&quot;material-ui/buttons&quot;</span>
<span class="c">// import * as buttons from &quot;material-ui/buttons&quot;</span>

<span class="k">let</span> <span class="i">deepOrange500</span> <span class="o">=</span> <span class="i">importMember</span><span class="o">&lt;</span><span class="i">string</span><span class="o">&gt;</span> <span class="s">&quot;material-ui/styles/colors&quot;</span>
<span class="c">// import { deepOrange500 } from &quot;material-ui/styles/colors&quot;</span>

<span class="k">let</span> <span class="i">getMuiTheme</span> <span class="o">=</span> <span class="i">importDefault</span><span class="o">&lt;</span><span class="i">obj</span><span class="k">-&gt;</span><span class="i">obj</span><span class="o">&gt;</span> <span class="s">&quot;material-ui/styles/getMuiTheme&quot;</span>
<span class="c">// import getMuiTheme from &quot;material-ui/styles/getMuiTheme&quot;</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>Note that Fable automatically uses the name of the let-bound variable
in the second example, this means you must always immediately assign the
result of <code>importMember</code> to a named value.
A difference between import attributes and expressions is the former are
not resolved in the file where they're declared (as this can be erased
bindings) but in the file where thery're used. While import expressions are
always resolved where they're declared. But if you don't understand this,
don't worry too much, this is usually transparent to the user :)</p>
</blockquote>
<h3><a name="Erase-attribute" class="anchor" href="#Erase-attribute">Erase attribute</a></h3>
<p>In TypeScript there's a concept of <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#union-types">Union Types</a>
which differs from union types in F#. The former are just used to statically check a function argument
accepting different types. In Fable, they're translated as <strong>Erased Union Types</strong>
whose cases must have one and only one single data field. After compilation, the wrapping
will be erased and only the data field will remain. To define an erased union type, just attach
the <code>Erase</code> attribute to the type. Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

[&lt;<span class="i">Erase</span>&gt;]
<span class="k">type</span> <span class="i">MyErasedType</span> <span class="o">=</span>
    | <span class="i">String</span> <span class="k">of</span> <span class="i">string</span>
    | <span class="i">Number</span> <span class="k">of</span> <span class="i">int</span>

<span class="i">myLib</span><span class="o">.</span><span class="i">myMethod</span>(<span class="i">String</span> <span class="s">&quot;test&quot;</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">myLib.myMethod(<span class="s">"test"</span>)
</code></pre></td></tr></table>
<p><code>Fable.Core</code> already includes predefined erased types which can be used as follows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

<span class="k">type</span> <span class="i">Test</span>() <span class="o">=</span>
    <span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">Value</span> <span class="o">=</span> <span class="s">&quot;Test&quot;</span>

<span class="k">let</span> <span class="i">myMethod</span> (<span class="i">arg</span><span class="o">:</span> <span class="i">U3</span><span class="o">&lt;</span><span class="i">string</span>, <span class="i">int</span>, <span class="i">Test</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">arg</span> <span class="k">with</span>
    | <span class="i">U3</span><span class="o">.</span><span class="i">Case1</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">s</span>
    | <span class="i">U3</span><span class="o">.</span><span class="i">Case2</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">string</span> <span class="i">i</span>
    | <span class="i">U3</span><span class="o">.</span><span class="i">Case3</span> <span class="i">t</span> <span class="k">-&gt;</span> <span class="i">t</span><span class="o">.</span><span class="i">Value</span>
</code></pre></td>
</tr>
</table>
<h3><a name="StringEnum-attribute" class="anchor" href="#StringEnum-attribute">StringEnum attribute</a></h3>
<p>Similarly, in TypeScript it's possible to define <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#string-literal-types">String Literal Types</a>
which are similar to enumerations with an underlying string value.
Fable allows the same feature by using union types and the <code>StringEnum</code> attribute.
These union types must not have any data fields as they will be compiled
to a string matching the name of the union case.</p>
<p>By default, the compiled string will have the first letter lowered.
If you want to prevent this or use a different text than the union
case name, use the <code>CompiledName</code> attribute:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

[&lt;<span class="i">StringEnum</span>&gt;]
<span class="k">type</span> <span class="i">MyStrings</span> <span class="o">=</span>
    | <span class="i">Vertical</span>
    | [&lt;<span class="i">CompiledName</span>(<span class="s">&quot;Horizontal&quot;</span>)&gt;] <span class="i">Horizontal</span>

<span class="i">myLib</span><span class="o">.</span><span class="i">myMethod</span>(<span class="i">Vertical</span>, <span class="i">Horizontal</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">myLib.myMethod(<span class="s">"vertical"</span>, <span class="s">"Horizontal"</span>)
</code></pre></td></tr></table>
<h3><a name="KeyValueList-attribute" class="anchor" href="#KeyValueList-attribute">KeyValueList attribute</a></h3>
<p>Many JS libraries accept a plain object to specify different options.
With Fable, you can use union types to define these options in a more
static-safe and F#-idiomatic manner. The union cases of a type with the
<code>KeyValueList</code> attribute act as a key value pair, so they should have a
single data field (if there's no data field the value is assumed to be <code>true</code>).
When Fable encounters a <strong>list</strong> of such an union type, it will compile it as
a plain JS object.</p>
<p>As with <code>StringEnum</code> the first letter of the key (the union case name)
will be lowered. Again, you can modify this behaviour with the <code>CompiledName</code>
attribute.</p>
<p>You can also allow custom key value pairs by adding an extra
union case with the <code>Erase</code> attribute.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span>

[&lt;<span class="i">KeyValueList</span>&gt;]
<span class="k">type</span> <span class="i">MyOptions</span> <span class="o">=</span>
    | <span class="i">Flag1</span>
    | <span class="i">Name</span> <span class="k">of</span> <span class="i">string</span>
    | [&lt;<span class="i">CompiledName</span>(<span class="s">&quot;QTY&quot;</span>)&gt;] <span class="i">QTY</span> <span class="k">of</span> <span class="i">int</span>
    | [&lt;<span class="i">Erase</span>&gt;] <span class="i">Extra</span> <span class="k">of</span> <span class="i">string</span> <span class="o">*</span> <span class="i">obj</span>

<span class="i">myLib</span><span class="o">.</span><span class="i">myMethod</span> [
    <span class="i">Name</span> <span class="s">&quot;Fable&quot;</span>
    <span class="i">QTY</span> <span class="n">5</span>
    <span class="i">Flag1</span>
    <span class="i">Extra</span> (<span class="s">&quot;newOption&quot;</span>, <span class="n">10.5</span>)
]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="js">myLib.myMethod({
    name: <span class="s">"Fable"</span>,
    QTY: <span class="n">5</span>,
    flag<span class="n">1</span>: <span class="k">true</span>,
    newOption: <span class="n">10.5</span>
})
</code></pre></td></tr></table>
<blockquote>
<p>Note: Using tuples directly will have the same effect as the <code>Erase</code> attribute:</p>
</blockquote>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">myLib</span><span class="o">.</span><span class="i">myMethod</span> [<span class="i">Name</span> <span class="s">&quot;Fable&quot;</span>; <span class="i">unbox</span>(<span class="s">&quot;level&quot;</span>, <span class="n">4</span>)]
<span class="c">// myLib.myMethod({ name: &quot;Fable&quot;, level: 4 })</span>
</code></pre></td>
</tr>
</table>
<p>As these lists will be compiled as JS objects, please note you
cannot apply the usual list operations to them (e.g. appending).
If you want to manipulate the "fake" lists you must implement the
methods yourself. For example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span class="i">KeyValueList</span>&gt;]
<span class="k">type</span> <span class="i">CSSProp</span> <span class="o">=</span>
    | <span class="i">Border</span> <span class="k">of</span> <span class="i">string</span>
    | <span class="i">Display</span> <span class="k">of</span> <span class="i">string</span>

[&lt;<span class="i">Emit</span>(<span class="s">&quot;Object.assign({}, $0, $1)&quot;</span>)&gt;]
<span class="k">let</span> ( <span class="o">++</span> ) (<span class="i">a</span><span class="o">:</span><span class="o">&#39;</span><span class="i">a</span> <span class="i">list</span>) (<span class="i">b</span><span class="o">:</span><span class="o">&#39;</span><span class="i">a</span> <span class="i">list</span>) <span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="i">list</span> <span class="o">=</span> <span class="i">jsNative</span>

<span class="k">let</span> <span class="i">niceBorder</span> <span class="o">=</span> [ <span class="i">Border</span> <span class="s">&quot;1px solid blue&quot;</span> ]
<span class="k">let</span> <span class="i">style</span> <span class="o">=</span> [ <span class="i">Display</span> <span class="s">&quot;inline-block&quot;</span> ] <span class="o">++</span> <span class="i">niceBorder</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Calling-F-code-from-JavaScript" class="anchor" href="#Calling-F-code-from-JavaScript">Calling F# code from JavaScript</a></h2>
<p>When interacting with JavaScript libraries, it's usual to send callbacks
that will be called from JS code. For this to work properly with F# functions
you must take a few things into consideration:</p>
<ul>
<li>In F# <strong>commas are always used for tuples</strong>:</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">fun</span> (<span class="i">x</span>, <span class="i">y</span>) <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>
<span class="c">// JS: function (tupledArg) { return tupledArg[0] + tupledArg[1]; }</span>
</code></pre></td>
</tr>
</table>
<ul>
<li>
In F# <strong>function arguments are always curried</strong>, so lambdas with multiple
arguments translate to single-argument functions returning another function.
To make it a multi-argument function in JS, you must <strong>convert it to a delegate</strong>
(like <code>System.Func&lt;_,_,_&gt;</code>):
</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>
<span class="c">// JS: function (x) { return function (y) { return x + y; } }</span>

<span class="i">System</span><span class="o">.</span><span class="i">Func</span><span class="o">&lt;</span>_,_,_<span class="o">&gt;</span>(<span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>)
<span class="c">// JS: function (x, y) { return x + y; }</span>
</code></pre></td>
</tr>
</table>
<ul>
<li>
Fable will <strong>automatically convert F# functions to delegates</strong> in some situations:
<ul>
<li>When passing an F# lambda to a method accepting a delegate.</li>
<li>When passing functions as arguments to <code>EmitAttribute</code>.</li>
<li>When using dynamic programming, with <code>?</code>, <code>$</code>, <code>createObj</code> or <code>createNew</code>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: If you experience problems make the conversion explicit.</p>
</blockquote>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">ITest</span> <span class="o">=</span>
    <span class="k">abstract</span> <span class="i">setCallback</span><span class="o">:</span> <span class="i">Func</span><span class="o">&lt;</span><span class="i">int</span>,<span class="i">int</span>,<span class="i">int</span><span class="o">&gt;</span> <span class="k">-&gt;</span> <span class="i">unit</span>

<span class="k">let</span> <span class="i">test</span>(<span class="i">o</span><span class="o">:</span> <span class="i">ITest</span>) <span class="o">=</span>
    <span class="i">o</span><span class="o">.</span><span class="i">setCallback</span>(<span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>)

<span class="c">// function test(o) {</span>
<span class="c">//   o.setCallback(function (x, y) {</span>
<span class="c">//     return x + y;</span>
<span class="c">//   });</span>
<span class="c">// }</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">myMeth</span> <span class="i">x</span> <span class="i">y</span> <span class="o">=</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>

<span class="k">let</span> <span class="i">test</span>(<span class="i">o</span><span class="o">:</span> <span class="i">obj</span>) <span class="o">=</span>
    <span class="i">o</span><span class="o">?</span><span class="i">foo</span>(<span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>) <span class="o">|&gt;</span> <span class="i">ignore</span>
    <span class="i">o</span><span class="o">?</span><span class="i">bar</span> <span class="o">&lt;-</span> <span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>

    <span class="c">// Direct application with ($) operator</span>
    <span class="i">o</span> <span class="o">$</span> (<span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">*</span> <span class="i">y</span>) <span class="o">|&gt;</span> <span class="i">ignore</span>

    <span class="i">createObj</span> [
        <span class="s">&quot;bar&quot;</span> <span class="o">==&gt;</span> <span class="k">fun</span> <span class="i">x</span> <span class="i">y</span> <span class="i">z</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">*</span> <span class="i">y</span> <span class="o">*</span> <span class="i">z</span>
        <span class="s">&quot;bar2&quot;</span> <span class="o">==&gt;</span> <span class="i">myMeth</span>
    ]

<span class="c">// function test(o) {</span>
<span class="c">//   o.foo(function (x, y) {</span>
<span class="c">//     return x + y;</span>
<span class="c">//   });</span>

<span class="c">//   o.bar = function (x, y) {</span>
<span class="c">//     return x + y;</span>
<span class="c">//   };</span>

<span class="c">//   o(function (x, y) {</span>
<span class="c">//     return x * y;</span>
<span class="c">//   });</span>

<span class="c">//   return {</span>
<span class="c">//     bar: function bar(x, y, z) {</span>
<span class="c">//       return x * y * z;</span>
<span class="c">//     },</span>
<span class="c">//     bar2: function bar2(x, y) {</span>
<span class="c">//       return myMeth(x, y);</span>
<span class="c">//     }</span>
<span class="c">//   };</span>
<span class="c">// }</span>
</code></pre></td>
</tr>
</table>
<h2><a name="JSON-serialization" class="anchor" href="#JSON-serialization">JSON serialization</a></h2>
<p>It's possible to use <code>JSON.stringify</code> and <code>JSON.parse</code> to serialize objects back
and forth, particularly with record and union types. Records will serialize as plain
JS objects and unions will be serialized the same way as with <a href="http://www.newtonsoft.com/json">Json.NET</a>,
making it easier to interact with a .NET server.</p>
<p>The only problem is <code>JSON.parse</code> will produce a plain JS object which won't work if
you need to type test it or access the prototype members. When this is necessary, you
can use <code>toJson</code> and <code>ofJson</code> functions in <code>Fable.Core.JsInterop</code> module. This will
save the type full name in a <code>$type</code> field so Fable will know which type to construct
when deserializing:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Core</span><span class="o">.</span><span class="i">JsInterop</span>

<span class="k">type</span> <span class="i">Tree</span> <span class="o">=</span>
    | <span class="i">Leaf</span> <span class="k">of</span> <span class="i">int</span>
    | <span class="i">Branch</span> <span class="k">of</span> <span class="i">Tree</span>[]
    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Sum</span>() <span class="o">=</span>
        <span class="k">match</span> <span class="i">this</span> <span class="k">with</span>
        | <span class="i">Leaf</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">i</span>
        | <span class="i">Branch</span> <span class="i">trees</span> <span class="k">-&gt;</span>
            <span class="i">trees</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Sum</span>()) <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">sum</span>

<span class="k">let</span> <span class="i">tree</span> <span class="o">=</span>
    <span class="i">Branch</span> [|<span class="i">Leaf</span> <span class="n">1</span>; <span class="i">Leaf</span> <span class="n">2</span>; <span class="i">Branch</span> [|<span class="i">Leaf</span> <span class="n">3</span>; <span class="i">Leaf</span> <span class="n">4</span>|]|]

<span class="k">let</span> <span class="i">json</span> <span class="o">=</span> <span class="i">toJson</span> <span class="i">tree</span>
<span class="k">let</span> <span class="i">tree2</span> <span class="o">=</span> <span class="i">ofJson</span><span class="o">&lt;</span><span class="i">Tree</span><span class="o">&gt;</span> <span class="i">json</span>

<span class="k">let</span> <span class="i">typeTest</span> <span class="o">=</span> <span class="i">box</span> <span class="i">tree2</span> <span class="o">:?</span> <span class="i">Tree</span>    <span class="c">// Type is kept</span>
<span class="k">let</span> <span class="i">sum</span> <span class="o">=</span> <span class="i">tree2</span><span class="o">.</span><span class="i">Sum</span>()   <span class="c">// Prototype members can be accessed</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>This will work when exchanging objects with a server, if the
server includes the type full name in a <code>$type</code> field and the
client code knows the type definiton. With Json.NET you can do
this by simply using the <code>TypeNameHandling.All</code> setting.</p>
</blockquote>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">R</span> <span class="o">=</span> { <span class="i">i</span><span class="o">:</span> <span class="i">int</span>; <span class="i">s</span><span class="o">:</span> <span class="i">string</span> }

<span class="k">let</span> <span class="i">x</span> <span class="o">=</span> { <span class="i">i</span><span class="o">=</span><span class="n">1</span>; <span class="i">s</span><span class="o">=</span><span class="s">&quot;1&quot;</span> }
<span class="k">let</span> <span class="i">json</span> <span class="o">=</span> <span class="i">JsonConvert</span><span class="o">.</span><span class="i">SerializeObject</span>(<span class="i">x</span>, <span class="i">JsonSerializerSettings</span>(<span class="i">TypeNameHandling</span><span class="o">=</span><span class="i">TypeNameHandling</span><span class="o">.</span><span class="i">All</span>))

<span class="c">// {&quot;$type&quot;:&quot;Fable.Tests.Lists+R, Fable.Tests&quot;,&quot;i&quot;:1,&quot;s&quot;:&quot;1&quot;}</span>
</code></pre></td>
</tr>
</table>
<p>Caveats:</p>
<ul>
<li>Works with records, unions and classes with an argumentless primary constructor.</li>
<li>
For classes, only properties (getters) will be serialized. Properties must also
have a public setter for correct deserialization (<code>[&lt;CLIMutable&gt;]</code> doesn't work).
</li>
<li>Arrays will always be deserialized as dynamic JS arrays, not typed arrays.</li>
<li>Not compatible with atttibutes like <code>[&lt;JsonIgnore&gt;]</code>.</li>
<li>
Fable doesn't include the same type information as Json.NET (generic arguments and assembly
name are missing), so you need to specify the target type for proper deserialization on
the server side.
</li>
<li>
<code>DateTime</code> will always be serialized in UTC format and any string matching the <a href="https://www.w3.org/TR/NOTE-datetime">DateTime ISO Format</a>
will be deserialized as a string.
</li>
<li>
Json.NET doesn't serialize type info for F# unions even when using the <code>TypeNameHandling.All</code> setting,
but you can use the following converter:
</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Reflection</span>
<span class="k">open</span> <span class="i">Newtonsoft</span><span class="o">.</span><span class="i">Json</span>
<span class="k">open</span> <span class="i">Newtonsoft</span><span class="o">.</span><span class="i">Json</span><span class="o">.</span><span class="i">Linq</span>

<span class="k">type</span> <span class="i">UnionTypeInfoConverter</span>() <span class="o">=</span>
    <span class="k">inherit</span> <span class="i">JsonConverter</span>()
    <span class="k">override</span> <span class="i">x</span><span class="o">.</span><span class="i">CanConvert</span> <span class="i">t</span> <span class="o">=</span> <span class="i">FSharpType</span><span class="o">.</span><span class="i">IsUnion</span> <span class="i">t</span>
    <span class="k">override</span> <span class="i">x</span><span class="o">.</span><span class="i">ReadJson</span>(<span class="i">reader</span>, <span class="i">t</span>, _, <span class="i">serializer</span>) <span class="o">=</span>
        <span class="k">let</span> <span class="i">token</span> <span class="o">=</span> <span class="i">JObject</span>()
        <span class="k">for</span> <span class="i">prop</span> <span class="k">in</span> <span class="i">JToken</span><span class="o">.</span><span class="i">ReadFrom</span>(<span class="i">reader</span>)<span class="o">.</span><span class="i">Children</span><span class="o">&lt;</span><span class="i">JProperty</span><span class="o">&gt;</span>() <span class="k">do</span>
            <span class="k">if</span> <span class="i">prop</span><span class="o">.</span><span class="i">Name</span> <span class="o">&lt;&gt;</span> <span class="s">&quot;$type&quot;</span> <span class="k">then</span>
                <span class="i">token</span><span class="o">.</span><span class="i">Add</span>(<span class="i">prop</span>)
        <span class="i">token</span><span class="o">.</span><span class="i">ToObject</span>(<span class="i">t</span>)
    <span class="k">override</span> <span class="i">x</span><span class="o">.</span><span class="i">WriteJson</span>(<span class="i">writer</span>, <span class="i">v</span>, <span class="i">serializer</span>) <span class="o">=</span>
        <span class="k">let</span> <span class="i">t</span> <span class="o">=</span> <span class="i">v</span><span class="o">.</span><span class="i">GetType</span>()
        <span class="k">let</span> <span class="i">typeFulName</span> <span class="o">=</span> <span class="i">t</span><span class="o">.</span><span class="i">FullName</span><span class="o">.</span><span class="i">Substring</span>(<span class="n">0</span>, <span class="i">t</span><span class="o">.</span><span class="i">FullName</span><span class="o">.</span><span class="i">LastIndexOf</span>(<span class="s">&quot;+&quot;</span>))
        <span class="k">let</span> <span class="i">uci</span>, <span class="i">fields</span> <span class="o">=</span> <span class="i">FSharpValue</span><span class="o">.</span><span class="i">GetUnionFields</span>(<span class="i">v</span>, <span class="i">t</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteStartObject</span>()
        <span class="i">writer</span><span class="o">.</span><span class="i">WritePropertyName</span>(<span class="s">&quot;$type&quot;</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteValue</span>(<span class="i">typeFulName</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WritePropertyName</span>(<span class="s">&quot;Case&quot;</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteValue</span>(<span class="i">uci</span><span class="o">.</span><span class="i">Name</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WritePropertyName</span>(<span class="s">&quot;Fields&quot;</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteStartArray</span>()
        <span class="k">for</span> <span class="i">field</span> <span class="k">in</span> <span class="i">fields</span> <span class="k">do</span> <span class="i">writer</span><span class="o">.</span><span class="i">WriteValue</span>(<span class="i">field</span>)
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteEndArray</span>()
        <span class="i">writer</span><span class="o">.</span><span class="i">WriteEndObject</span>()

<span class="k">let</span> <span class="i">settings</span> <span class="o">=</span>
    <span class="i">JsonSerializerSettings</span>(
        <span class="i">Converters</span> <span class="o">=</span> [|<span class="i">UnionTypeInfoConverter</span>()|],
        <span class="i">TypeNameHandling</span> <span class="o">=</span> <span class="i">TypeNameHandling</span><span class="o">.</span><span class="i">All</span>)

<span class="k">type</span> <span class="i">U</span> <span class="o">=</span> <span class="i">A</span> <span class="k">of</span> <span class="i">int</span> | <span class="i">B</span> <span class="k">of</span> <span class="i">string</span> <span class="o">*</span> <span class="i">float</span>
<span class="i">JsonConvert</span><span class="o">.</span><span class="i">SerializeObject</span>(<span class="i">A</span> <span class="n">4</span>, <span class="i">settings</span>)
<span class="i">JsonConvert</span><span class="o">.</span><span class="i">SerializeObject</span>(<span class="i">B</span>(<span class="s">&quot;hi&quot;</span>,<span class="n">5.6</span>), <span class="i">settings</span>)
</code></pre></td>
</tr>
</table>
<h2><a name="Publishing-a-Fable-package" class="anchor" href="#Publishing-a-Fable-package">Publishing a Fable package</a></h2>
<p>See <a href="https://www.npmjs.com/package/fable-helpers-sample">fable-helpers-sample</a> to know how to publish a Fable package.</p>



    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>
</div>

  </div>

  <a class="gh-forkme" href="https://github.com/fable-compiler/Fable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
</body>
</html>
