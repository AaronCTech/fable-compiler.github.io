<html><head><title>Fable Docs</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700|Roboto+Mono"/><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" type="text/css" href="/css/styles.css"/><link rel="stylesheet" type="text/css" href="/css/highlight.css"/><link rel="shortcut icon" href="/img/fable.ico"/></head><body><nav class="navbar"><div class="navbar-brand"><div class="navbar-item title is-4">Fable</div><div class="navbar-burger" data-target="navMenu"><span></span><span></span><span></span></div></div><div id="navMenu" class=" navbar-menu"><div class="navbar-start"><a class=" navbar-item" href="/">Home</a><a class=" navbar-item" href="/repl2">REPL</a><a class=" navbar-item" href="/blog">Blog</a><a class=" navbar-item is-active" href="/docs">Docs</a><a class=" navbar-item" href="/faq">FAQ</a><a class=" navbar-item" href="/fableconf">FableConf</a></div><div class="navbar-end"><div class="navbar-item"><div class="field is-grouped"><div class="control"><a class="button twitter" href="https://twitter.com/FableCompiler"><span class="icon"><i class="fa fa-twitter"></i></span><span>Share the love!</span></a></div><div class="control"><a class="button github" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class="fa fa-comments"></i></span><span>Chat</span></a></div><div class="control"><a class="button github" href="https://github.com/fable-compiler/Fable"><span class="icon"><i class="fa fa-github"></i></span><span>Contribute</span></a></div></div></div></div></div></nav><div class="markdown docs" style="overflow:hidden"><section class="hero fable-header"><div class="hero-body"><div class="container"><div class="columns is-vcentered"><div class="column"><img class="fable-logo" src="/img/fable_logo.png"/></div><div class="column    has-text-right        "><h1 class="title is-1">Documentation</h1><h1 class="subtitle is-4">Learn how Fable works &amp; how to use it</h1></div></div></div></div></section><div style="margin-top:1.6rem"><div class="columns"><div class="column"></div><div class="column is-two-thirds"><div class="content" style="margin:5px"><h1><a name="numbers-in-fable" class="anchor" href="#numbers-in-fable">Numbers in Fable</a></h1><p>Fable numbers are very nearly compatible with .NET semantics, but translating into Javascript types has consequences:</p>
<ul>
<li>(non-standard) All floating point numbers are implemented as 64 bit (<code>double</code>). This makes <code>float</code> numbers more accurate than expected.</li>
<li>(non-standard) Arithmetic integers of 32 bits or less are implemented with different truncation from that expected, as whole numbers embedded within <code>double</code>.</li>
<li>(OK) Conversions between types are correctly truncated.</li>
<li>(OK) Bitwise operations are all correct, and when made on 32 bit integers are truncated to 32 bits.</li>
<li>(OK) Longs have a custom implementation which is identical in semantics to .NET and truncates in 64 bits: although it is quite slow.</li>
</ul>
<p>32 bit integers thus differ from .NET in two ways:</p>
<ul>
<li>Underlying 52 bit precision, without expected truncation to 32 bits on overflow. Truncation can be forced if needed by <code>&gt;&gt;&gt; 0</code>.</li>
<li>On exceeding 52 bits absolute value floating point loses precision. So overflow will result in unexpected lower order 0 bits.</li>
</ul>
<p>The loss of precision can be seen in a single multiplication:</p>
<pre><code>((1 &lt;&lt;&lt; 28) + 1) * ((1 &lt;&lt;&lt; 28) + 1) &gt;&gt;&gt; 0
</code></pre><p>The multiply product will have internal double representation rounded to <code>0x0100,0000,2000,0000</code>. When it is truncated to 32 bits by
<code>&gt;&gt;&gt; 0</code> the result will be  <code>0x2000,0000</code> not the .NET exact lower order bits value of <code>0x2000,0001</code>.</p>
<p>The same problem can be seen where repeated arithmetic operations make the internal (non-truncated) value large. For example a linear
congruence random number generator:</p>
<pre><code>let rng (s:int32) = 10001*s + 12345</code></pre><p>The numbers generated by repeated application of this to its result will all be even after the 4th pseudo-random number, when <code>s</code> value exceeds 2^53:</p>
<pre><code>let rec randLst n s =
    match n with
    | 0 -&gt; [s]
    | n -&gt; s :: randLst (n-1) (rng s)

List.iter (printfn "%x") (randLst 7 1)</code></pre><p>The resulting printed list of pseudo-random numbers does not work in Fable:</p>
<table>
<thead>
<tr>
<th align="right">Fable</th>
<th align="right">.Net</th>
</tr>
</thead>
<tbody><tr>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">574a</td>
<td align="right">574a</td>
</tr>
<tr>
<td align="right">d524223</td>
<td align="right">d524223</td>
</tr>
<tr>
<td align="right">6a89e98c</td>
<td align="right">6a89e98c</td>
</tr>
<tr>
<td align="right">15bd0684</td>
<td align="right">15bd0685</td>
</tr>
<tr>
<td align="right">3d8b8000</td>
<td align="right">3d8be20e</td>
</tr>
<tr>
<td align="right">50000000</td>
<td align="right">65ba5527</td>
</tr>
<tr>
<td align="right">0</td>
<td align="right">2458c8d0</td>
</tr>
</tbody></table>
<h2><a name="workarounds" class="anchor" href="#workarounds">Workarounds</a></h2><ul>
<li>When accurate low-order bit arithmetic is needed and overflow can result in numbers larger than 2^53 use <code>int64</code>, <code>uint64</code>, which use exact 64 bits, instead of <code>int32</code>, <code>uint32</code>.</li>
<li>Alternately, truncate all arithmetic with <code>&gt;&gt;&gt; 0</code> or <code>&gt;&gt;&gt; 0u</code> as appropriate before numbers can get larger than 2^53: <br> <code>let rng (s:int32) = 10001*s + 12345 &gt;&gt;&gt; 0</code></li>
</ul>
<h2><a name="printing" class="anchor" href="#printing">Printing</a></h2><p>One small change from .NET in <code>printf</code>, <code>sprintf</code>, <code>ToString</code>. Negative signed integers are printed in hexadecimal format as sign + magnitude,
in .Net they are printed as two&#39;s complement bit patterns.</p>
</div></div><div class="column"></div></div></div></div><footer><p>Fable <a href="https://github.com/fable-compiler/Fable">source code</a> is licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.</p></footer><script>
document.addEventListener('DOMContentLoaded', function () {
  var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
  if ($navbarBurgers.length > 0) {
    $navbarBurgers.forEach(function ($el) {
      $el.addEventListener('click', function () {
        var target = $el.dataset.target;
        var $target = document.getElementById(target);
        $el.classList.toggle('is-active');
        $target.classList.toggle('is-active');
      });
    });
  }
});</script></body></html>